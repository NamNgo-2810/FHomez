"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _Credentials = _interopRequireDefault(require("./Credentials"));

var _JwtGenerator = _interopRequireDefault(require("./JwtGenerator"));

var _HashGenerator = _interopRequireDefault(require("./HashGenerator"));

var _Message = _interopRequireDefault(require("./Message"));

var _Voice = _interopRequireDefault(require("./Voice"));

var _Number = _interopRequireDefault(require("./Number"));

var _Verify = _interopRequireDefault(require("./Verify"));

var _NumberInsight = _interopRequireDefault(require("./NumberInsight"));

var _App = _interopRequireDefault(require("./App"));

var _Account = _interopRequireDefault(require("./Account"));

var _CallsResource = _interopRequireDefault(require("./CallsResource"));

var _Conversations = _interopRequireDefault(require("./Conversations"));

var _Users = _interopRequireDefault(require("./Users"));

var _FilesResource = _interopRequireDefault(require("./FilesResource"));

var _Conversion = _interopRequireDefault(require("./Conversion"));

var _Media = _interopRequireDefault(require("./Media"));

var _Redact = _interopRequireDefault(require("./Redact"));

var _Channel = _interopRequireDefault(require("./Channel"));

var _Dispatch = _interopRequireDefault(require("./Dispatch"));

var _Pricing = _interopRequireDefault(require("./Pricing"));

var _HttpClient = _interopRequireDefault(require("./HttpClient"));

var _NullLogger = _interopRequireDefault(require("./NullLogger"));

var _ConsoleLogger = _interopRequireDefault(require("./ConsoleLogger"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var jwtGeneratorInstance = new _JwtGenerator.default();
var hashGeneratorInstance = new _HashGenerator.default();

class Vonage {
  /**
   * @param {Credentials} credentials - Vonage API credentials
   * @param {string} credentials.apiKey - the Vonage API key
   * @param {string} credentials.apiSecret - the Vonage API secret
   * @param {Object} options - Additional options
   * @param {boolean} options.debug - `true` to turn on debug logging
   * @param {Object} options.logger - Set a custom logger.
   * @param {string} options.appendToUserAgent - A value to append to the user agent.
   *                    The value will be prefixed with a `/`
   */
  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      debug: false
    };
    this.credentials = _Credentials.default.parse(credentials);
    this.options = Object.assign({}, options); // If no logger has been supplied but debug has been set
    // default to using the ConsoleLogger

    if (!this.options.logger && this.options.debug) {
      this.options.logger = new _ConsoleLogger.default();
    } else if (!this.options.logger) {
      // Swallow the logging
      this.options.logger = new _NullLogger.default();
    }

    var userAgent = "@vonage/server-sdk/UNKNOWN node/UNKNOWN";

    try {
      var packageDetails = require(_path.default.join(__dirname, "..", "package.json"));

      userAgent = "@vonage/server-sdk/".concat(packageDetails.version, " node/").concat(process.version.replace("v", ""));
    } catch (e) {
      console.warn("Could not load package details");
    }

    this.options.userAgent = userAgent;

    if (this.options.appendToUserAgent) {
      this.options.userAgent += " ".concat(this.options.appendToUserAgent);
    } // This is legacy, everything should use rest or api going forward


    this.options.httpClient = new _HttpClient.default(Object.assign({
      host: this.options.restHost || "rest.nexmo.com"
    }, this.options), this.credentials); // We have two different hosts, so we use two different HttpClients

    this.options.api = new _HttpClient.default(Object.assign({
      host: this.options.apiHost || "api.nexmo.com"
    }, this.options), this.credentials);
    this.options.rest = new _HttpClient.default(Object.assign({
      host: this.options.restHost || "rest.nexmo.com"
    }, this.options), this.credentials);
    this.message = new _Message.default(this.credentials, this.options);
    this.voice = new _Voice.default(this.credentials, this.options);
    this.number = new _Number.default(this.credentials, this.options);
    this.verify = new _Verify.default(this.credentials, this.options);
    this.numberInsight = new _NumberInsight.default(this.credentials, this.options);
    this.applications = new _App.default(this.credentials, this.options);
    this.account = new _Account.default(this.credentials, this.options);
    this.calls = new _CallsResource.default(this.credentials, this.options);
    this.conversations = new _Conversations.default(this.credentials, this.options);
    this.users = new _Users.default(this.credentials, this.options);
    this.files = new _FilesResource.default(this.credentials, this.options);
    this.conversion = new _Conversion.default(this.credentials, this.options);
    this.media = new _Media.default(this.credentials, this.options);
    this.redact = new _Redact.default(this.credentials, this.options);
    this.channel = new _Channel.default(this.credentials, this.options);
    this.dispatch = new _Dispatch.default(this.credentials, this.options);
    this.pricing = new _Pricing.default(this.credentials, this.options);
    /**
     * @deprecated Please use vonage.applications
     */

    this.app = this.applications;
  }
  /**
   * Generate a JSON Web Token (JWT).
   *
   * The private key used upon Vonage instance construction will be used to sign
   * the JWT. The application_id you used upon Vonage instance creation will be
   * included in the claims for the JWT, however this can be overridden by passing
   * an application_id as part of the claims.
   *
   * @param {Object} claims - name/value pair claims to sign within the JWT
   *
   * @returns {String} the generated token
   */


  generateJwt() {
    var claims = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    if (claims.application_id === undefined) {
      claims.application_id = this.credentials.applicationId;
    }

    return Vonage.generateJwt(this.credentials.privateKey, claims);
  }
  /**
   * Generate a Signature Hash.
   *
   * @param {Object} params - params to generate hash from
   *
   * @returns {String} the generated token
   */


  generateSignature(params) {
    return this.credentials.generateSignature(params);
  }

}
/**
 * Generate a JSON Web Token (JWT).
 *
 * @param {String|Buffer} privateKey - the path to the private key certificate
 *          to be used when signing the claims.
 * @param {Object} claims - name/value pair claims to sign within the JWT
 *
 * @returns {String} the generated token
 */


Vonage.generateJwt = (privateKey, claims) => {
  if (!(privateKey instanceof Buffer)) {
    if (!_fs.default.existsSync(privateKey)) {
      throw new Error("File \"".concat(privateKey, "\" not found."));
    } else {
      privateKey = _fs.default.readFileSync(privateKey);
    }
  }

  return jwtGeneratorInstance.generate(privateKey, claims);
};
/**
 * Generate a Signature Hash.
 *
 * @param {String} method - the method to be used when creating the hash
 * @param {String} secret - the secret to be used when creating the hash
 * @param {Object} params - params to generate hash from
 *
 * @returns {String} the generated token
 */


Vonage.generateSignature = (method, secret, params) => {
  return hashGeneratorInstance.generate(method, secret, params);
};

var _default = Vonage;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Wb25hZ2UuanMiXSwibmFtZXMiOlsiand0R2VuZXJhdG9ySW5zdGFuY2UiLCJKd3RHZW5lcmF0b3IiLCJoYXNoR2VuZXJhdG9ySW5zdGFuY2UiLCJIYXNoR2VuZXJhdG9yIiwiVm9uYWdlIiwiY29uc3RydWN0b3IiLCJjcmVkZW50aWFscyIsIm9wdGlvbnMiLCJkZWJ1ZyIsIkNyZWRlbnRpYWxzIiwicGFyc2UiLCJPYmplY3QiLCJhc3NpZ24iLCJsb2dnZXIiLCJDb25zb2xlTG9nZ2VyIiwiTnVsbExvZ2dlciIsInVzZXJBZ2VudCIsInBhY2thZ2VEZXRhaWxzIiwicmVxdWlyZSIsInBhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwidmVyc2lvbiIsInByb2Nlc3MiLCJyZXBsYWNlIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiYXBwZW5kVG9Vc2VyQWdlbnQiLCJodHRwQ2xpZW50IiwiSHR0cENsaWVudCIsImhvc3QiLCJyZXN0SG9zdCIsImFwaSIsImFwaUhvc3QiLCJyZXN0IiwibWVzc2FnZSIsIk1lc3NhZ2UiLCJ2b2ljZSIsIlZvaWNlIiwibnVtYmVyIiwiTnVtYmVyIiwidmVyaWZ5IiwiVmVyaWZ5IiwibnVtYmVySW5zaWdodCIsIk51bWJlckluc2lnaHQiLCJhcHBsaWNhdGlvbnMiLCJBcHAiLCJhY2NvdW50IiwiQWNjb3VudCIsImNhbGxzIiwiQ2FsbHNSZXNvdXJjZSIsImNvbnZlcnNhdGlvbnMiLCJDb252ZXJzYXRpb25zIiwidXNlcnMiLCJVc2VycyIsImZpbGVzIiwiRmlsZXNSZXNvdXJjZSIsImNvbnZlcnNpb24iLCJDb252ZXJzaW9uIiwibWVkaWEiLCJNZWRpYSIsInJlZGFjdCIsIlJlZGFjdCIsImNoYW5uZWwiLCJDaGFubmVsIiwiZGlzcGF0Y2giLCJEaXNwYXRjaCIsInByaWNpbmciLCJQcmljaW5nIiwiYXBwIiwiZ2VuZXJhdGVKd3QiLCJjbGFpbXMiLCJhcHBsaWNhdGlvbl9pZCIsInVuZGVmaW5lZCIsImFwcGxpY2F0aW9uSWQiLCJwcml2YXRlS2V5IiwiZ2VuZXJhdGVTaWduYXR1cmUiLCJwYXJhbXMiLCJCdWZmZXIiLCJmcyIsImV4aXN0c1N5bmMiLCJFcnJvciIsInJlYWRGaWxlU3luYyIsImdlbmVyYXRlIiwibWV0aG9kIiwic2VjcmV0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxvQkFBb0IsR0FBRyxJQUFJQyxxQkFBSixFQUE3QjtBQUNBLElBQU1DLHFCQUFxQixHQUFHLElBQUlDLHNCQUFKLEVBQTlCOztBQUVBLE1BQU1DLE1BQU4sQ0FBYTtBQUNYO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0VDLEVBQUFBLFdBQVcsQ0FBQ0MsV0FBRCxFQUEwQztBQUFBLFFBQTVCQyxPQUE0Qix1RUFBbEI7QUFBRUMsTUFBQUEsS0FBSyxFQUFFO0FBQVQsS0FBa0I7QUFDbkQsU0FBS0YsV0FBTCxHQUFtQkcscUJBQVlDLEtBQVosQ0FBa0JKLFdBQWxCLENBQW5CO0FBQ0EsU0FBS0MsT0FBTCxHQUFlSSxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCTCxPQUFsQixDQUFmLENBRm1ELENBSW5EO0FBQ0E7O0FBQ0EsUUFBSSxDQUFDLEtBQUtBLE9BQUwsQ0FBYU0sTUFBZCxJQUF3QixLQUFLTixPQUFMLENBQWFDLEtBQXpDLEVBQWdEO0FBQzlDLFdBQUtELE9BQUwsQ0FBYU0sTUFBYixHQUFzQixJQUFJQyxzQkFBSixFQUF0QjtBQUNELEtBRkQsTUFFTyxJQUFJLENBQUMsS0FBS1AsT0FBTCxDQUFhTSxNQUFsQixFQUEwQjtBQUMvQjtBQUNBLFdBQUtOLE9BQUwsQ0FBYU0sTUFBYixHQUFzQixJ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Z0RKLE1BQWhELENBQVA7QUFDRDtBQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDRUssRUFBQUEsaUJBQWlCLENBQUNDLE1BQUQsRUFBUztBQUN4QixXQUFPLEtBQUt4RSxXQUFMLENBQWlCdUUsaUJBQWpCLENBQW1DQyxNQUFuQyxDQUFQO0FBQ0Q7O0FBcEhVO0FBdUhiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0ExRSxNQUFNLENBQUNtRSxXQUFQLEdBQXFCLENBQUNLLFVBQUQsRUFBYUosTUFBYixLQUF3QjtBQUMzQyxNQUFJLEVBQUVJLFVBQVUsWUFBWUcsTUFBeEIsQ0FBSixFQUFxQztBQUNuQyxRQUFJLENBQUNDLFlBQUdDLFVBQUgsQ0FBY0wsVUFBZCxDQUFMLEVBQWdDO0FBQzlCLFlBQU0sSUFBSU0sS0FBSixrQkFBbUJOLFVBQW5CLG1CQUFOO0FBQ0QsS0FGRCxNQUVPO0FBQ0xBLE1BQUFBLFVBQVUsR0FBR0ksWUFBR0csWUFBSCxDQUFnQlAsVUFBaEIsQ0FBYjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBTzVFLG9CQUFvQixDQUFDb0YsUUFBckIsQ0FBOEJSLFVBQTlCLEVBQTBDSixNQUExQyxDQUFQO0FBQ0QsQ0FURDtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0FwRSxNQUFNLENBQUN5RSxpQkFBUCxHQUEyQixDQUFDUSxNQUFELEVBQVNDLE1BQVQsRUFBaUJSLE1BQWpCLEtBQTRCO0FBQ3JELFNBQU81RSxxQkFBcUIsQ0FBQ2tGLFFBQXRCLENBQStCQyxNQUEvQixFQUF1Q0MsTUFBdkMsRUFBK0NSLE1BQS9DLENBQVA7QUFDRCxDQUZEOztlQUllMUUsTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5cbmltcG9ydCBDcmVkZW50aWFscyBmcm9tIFwiLi9DcmVkZW50aWFsc1wiO1xuaW1wb3J0IEp3dEdlbmVyYXRvciBmcm9tIFwiLi9Kd3RHZW5lcmF0b3JcIjtcbmltcG9ydCBIYXNoR2VuZXJhdG9yIGZyb20gXCIuL0hhc2hHZW5lcmF0b3JcIjtcbmltcG9ydCBNZXNzYWdlIGZyb20gXCIuL01lc3NhZ2VcIjtcbmltcG9ydCBWb2ljZSBmcm9tIFwiLi9Wb2ljZVwiO1xuaW1wb3J0IE51bWJlciBmcm9tIFwiLi9OdW1iZXJcIjtcbmltcG9ydCBWZXJpZnkgZnJvbSBcIi4vVmVyaWZ5XCI7XG5pbXBvcnQgTnVtYmVySW5zaWdodCBmcm9tIFwiLi9OdW1iZXJJbnNpZ2h0XCI7XG5pbXBvcnQgQXBwIGZyb20gXCIuL0FwcFwiO1xuaW1wb3J0IEFjY291bnQgZnJvbSBcIi4vQWNjb3VudFwiO1xuaW1wb3J0IENhbGxzUmVzb3VyY2UgZnJvbSBcIi4vQ2FsbHNSZXNvdXJjZVwiO1xuaW1wb3J0IENvbnZlcnNhdGlvbnMgZnJvbSBcIi4vQ29udmVyc2F0aW9uc1wiO1xuaW1wb3J0IFVzZXJzIGZyb20gXCIuL1VzZXJzXCI7XG5pbXBvcnQgRmlsZXNSZXNvdXJjZSBmcm9tIFwiLi9GaWxlc1Jlc291cmNlXCI7XG5pbXBvcnQgQ29udmVyc2lvbiBmcm9tIFwiLi9Db252ZXJzaW9uXCI7XG5pbXBvcnQgTWVkaWEgZnJvbSBcIi4vTWVkaWFcIjtcbmltcG9ydCBSZWRhY3QgZnJvbSBcIi4vUmVkYWN0XCI7XG5pbXBvcnQgQ2hhbm5lbCBmcm9tIFwiLi9DaGFubmVsXCI7XG5pbXBvcnQgRGlzcGF0Y2ggZnJvbSBcIi4vRGlzcGF0Y2hcIjtcbmltcG9ydCBQcmljaW5nIGZyb20gXCIuL1ByaWNpbmdcIjtcbmltcG9ydCBIdHRwQ2xpZW50IGZyb20gXCIuL0h0dHBDbGllbnRcIjtcbmltcG9ydCBOdWxsTG9nZ2VyIGZyb20gXCIuL051bGxMb2dnZXJcIjtcbmltcG9ydCBDb25zb2xlTG9nZ2VyIGZyb20gXCIuL0NvbnNvbGVMb2dnZXJcIjtcblxuY29uc3Qgand0R2VuZXJhdG9ySW5zdGFuY2UgPSBuZXcgSnd0R2VuZXJhdG9yKCk7XG5jb25zdCBoYXNoR2VuZXJhdG9ySW5zdGFuY2UgPSBuZXcgSGFzaEdlbmVyYXRvcigpO1xuXG5jbGFzcyBWb25hZ2Uge1xuICAvKipcbiAgICogQHBhcmFtIHtDcmVkZW50aWFsc30gY3JlZGVudGlhbHMgLSBWb25hZ2UgQVBJIGNyZWRlbnRpYWxzXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjcmVkZW50aWFscy5hcGlLZXkgLSB0aGUgVm9uYWdlIEFQSSBrZXlcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNyZWRlbnRpYWxzLmFwaVNlY3JldCAtIHRoZSBWb25hZ2UgQVBJIHNlY3JldFxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIEFkZGl0aW9uYWwgb3B0aW9uc1xuICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMuZGVidWcgLSBgdHJ1ZWAgdG8gdHVybiBvbiBkZWJ1ZyBsb2dnaW5nXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zLmxvZ2dlciAtIFNldCBhIGN1c3RvbSBsb2dnZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLmFwcGVuZFRvVXNlckFnZW50IC0gQSB2YWx1ZSB0byBhcHBlbmQgdG8gdGhlIHVzZXIgYWdlbnQuXG4gICAqICAgICAgICAgICAgICAgICAgICBUaGUgdmFsdWUgd2lsbCBiZSBwcmVmaXhlZCB3aXRoIGEgYC9gXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjcmVkZW50aWFscywgb3B0aW9ucyA9IHsgZGVidWc6IGZhbHNlIH0pIHtcbiAgICB0aGlzLmNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbHMucGFyc2UoY3JlZGVudGlhbHMpO1xuICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuXG4gICAgLy8gSWYgbm8gbG9nZ2VyIGhhcyBiZWVuIHN1cHBsaWVkIGJ1dCBkZWJ1ZyBoYXMgYmVlbiBzZXRcbiAgICAvLyBkZWZhdWx0IHRvIHVzaW5nIHRoZSBDb25zb2xlTG9nZ2VyXG4gICAgaWYgKCF0aGlzLm9wdGlvbnMubG9nZ2VyICYmIHRoaXMub3B0aW9ucy5kZWJ1Zykge1xuICAgICAgdGhpcy5vcHRpb25zLmxvZ2dlciA9IG5ldyBDb25zb2xlTG9nZ2VyKCk7XG4gICAgfSBlbHNlIGlmICghdGhpcy5vcHRpb25zLmxvZ2dlcikge1xuICAgICAgLy8gU3dhbGxvdyB0aGUgbG9nZ2luZ1xuICAgICAgdGhpcy5vcHRpb25zLmxvZ2dlciA9IG5ldyBOdWxsTG9nZ2VyKCk7XG4gICAgfVxuXG4gICAgbGV0IHVzZXJBZ2VudCA9IFwiQHZvbmFnZS9zZXJ2ZXItc2RrL1VOS05PV04gbm9kZS9VTktOT1dOXCI7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBwYWNrYWdlRGV0YWlscyA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLlwiLCBcInBhY2thZ2UuanNvblwiKSk7XG4gICAgICB1c2VyQWdlbnQgPSBgQHZvbmFnZS9zZXJ2ZXItc2RrLyR7XG4gICAgICAgIHBhY2thZ2VEZXRhaWxzLnZlcnNpb25cbiAgICAgIH0gbm9kZS8ke3Byb2Nlc3MudmVyc2lvbi5yZXBsYWNlKFwidlwiLCBcIlwiKX1gO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCBsb2FkIHBhY2thZ2UgZGV0YWlsc1wiKTtcbiAgICB9XG4gICAgdGhpcy5vcHRpb25zLnVzZXJBZ2VudCA9IHVzZXJBZ2VudDtcbiAgICBpZiAodGhpcy5vcHRpb25zLmFwcGVuZFRvVXNlckFnZW50KSB7XG4gICAgICB0aGlzLm9wdGlvbnMudXNlckFnZW50ICs9IGAgJHt0aGlzLm9wdGlvbnMuYXBwZW5kVG9Vc2VyQWdlbnR9YDtcbiAgICB9XG5cbiAgICAvLyBUaGlzIGlzIGxlZ2FjeSwgZXZlcnl0aGluZyBzaG91bGQgdXNlIHJlc3Qgb3IgYXBpIGdvaW5nIGZvcndhcmRcbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudCA9IG5ldyBIdHRwQ2xpZW50KFxuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgeyBob3N0OiB0aGlzLm9wdGlvbnMucmVzdEhvc3QgfHwgXCJyZXN0Lm5leG1vLmNvbVwiIH0sXG4gICAgICAgIHRoaXMub3B0aW9uc1xuICAgICAgKSxcbiAgICAgIHRoaXMuY3JlZGVudGlhbHNcbiAgICApO1xuXG4gICAgLy8gV2UgaGF2ZSB0d28gZGlmZmVyZW50IGhvc3RzLCBzbyB3ZSB1c2UgdHdvIGRpZmZlcmVudCBIdHRwQ2xpZW50c1xuICAgIHRoaXMub3B0aW9ucy5hcGkgPSBuZXcgSHR0cENsaWVudChcbiAgICAgIE9iamVjdC5hc3NpZ24oXG4gICAgICAgIHsgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIgfSxcbiAgICAgICAgdGhpcy5vcHRpb25zXG4gICAgICApLFxuICAgICAgdGhpcy5jcmVkZW50aWFsc1xuICAgICk7XG4gICAgdGhpcy5vcHRpb25zLnJlc3QgPSBuZXcgSHR0cENsaWVudChcbiAgICAgIE9iamVjdC5hc3NpZ24oXG4gICAgICAgIHsgaG9zdDogdGhpcy5vcHRpb25zLnJlc3RIb3N0IHx8IFwicmVzdC5uZXhtby5jb21cIiB9LFxuICAgICAgICB0aGlzLm9wdGlvbnNcbiAgICAgICksXG4gICAgICB0aGlzLmNyZWRlbnRpYWxzXG4gICAgKTtcblxuICAgIHRoaXMubWVzc2FnZSA9IG5ldyBNZXNzYWdlKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy52b2ljZSA9IG5ldyBWb2ljZSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMubnVtYmVyID0gbmV3IE51bWJlcih0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMudmVyaWZ5ID0gbmV3IFZlcmlmeSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMubnVtYmVySW5zaWdodCA9IG5ldyBOdW1iZXJJbnNpZ2h0KHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5hcHBsaWNhdGlvbnMgPSBuZXcgQXBwKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5hY2NvdW50ID0gbmV3IEFjY291bnQodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmNhbGxzID0gbmV3IENhbGxzUmVzb3VyY2UodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmNvbnZlcnNhdGlvbnMgPSBuZXcgQ29udmVyc2F0aW9ucyh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMudXNlcnMgPSBuZXcgVXNlcnModGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmZpbGVzID0gbmV3IEZpbGVzUmVzb3VyY2UodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmNvbnZlcnNpb24gPSBuZXcgQ29udmVyc2lvbih0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMubWVkaWEgPSBuZXcgTWVkaWEodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnJlZGFjdCA9IG5ldyBSZWRhY3QodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmNoYW5uZWwgPSBuZXcgQ2hhbm5lbCh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuZGlzcGF0Y2ggPSBuZXcgRGlzcGF0Y2godGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnByaWNpbmcgPSBuZXcgUHJpY2luZyh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuXG4gICAgLyoqXG4gICAgICogQGRlcHJlY2F0ZWQgUGxlYXNlIHVzZSB2b25hZ2UuYXBwbGljYXRpb25zXG4gICAgICovXG4gICAgdGhpcy5hcHAgPSB0aGlzLmFwcGxpY2F0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIEpTT04gV2ViIFRva2VuIChKV1QpLlxuICAgKlxuICAgKiBUaGUgcHJpdmF0ZSBrZXkgdXNlZCB1cG9uIFZvbmFnZSBpbnN0YW5jZSBjb25zdHJ1Y3Rpb24gd2lsbCBiZSB1c2VkIHRvIHNpZ25cbiAgICogdGhlIEpXVC4gVGhlIGFwcGxpY2F0aW9uX2lkIHlvdSB1c2VkIHVwb24gVm9uYWdlIGluc3RhbmNlIGNyZWF0aW9uIHdpbGwgYmVcbiAgICogaW5jbHVkZWQgaW4gdGhlIGNsYWltcyBmb3IgdGhlIEpXVCwgaG93ZXZlciB0aGlzIGNhbiBiZSBvdmVycmlkZGVuIGJ5IHBhc3NpbmdcbiAgICogYW4gYXBwbGljYXRpb25faWQgYXMgcGFydCBvZiB0aGUgY2xhaW1zLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2xhaW1zIC0gbmFtZS92YWx1ZSBwYWlyIGNsYWltcyB0byBzaWduIHdpdGhpbiB0aGUgSldUXG4gICAqXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBnZW5lcmF0ZWQgdG9rZW5cbiAgICovXG5cbiAgZ2VuZXJhdGVKd3QoY2xhaW1zID0ge30pIHtcbiAgICBpZiAoY2xhaW1zLmFwcGxpY2F0aW9uX2lkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNsYWltcy5hcHBsaWNhdGlvbl9pZCA9IHRoaXMuY3JlZGVudGlhbHMuYXBwbGljYXRpb25JZDtcbiAgICB9XG4gICAgcmV0dXJuIFZvbmFnZS5nZW5lcmF0ZUp3dCh0aGlzLmNyZWRlbnRpYWxzLnByaXZhdGVLZXksIGNsYWltcyk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBTaWduYXR1cmUgSGFzaC5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyAtIHBhcmFtcyB0byBnZW5lcmF0ZSBoYXNoIGZyb21cbiAgICpcbiAgICogQHJldHVybnMge1N0cmluZ30gdGhlIGdlbmVyYXRlZCB0b2tlblxuICAgKi9cbiAgZ2VuZXJhdGVTaWduYXR1cmUocGFyYW1zKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlZGVudGlhbHMuZ2VuZXJhdGVTaWduYXR1cmUocGFyYW1zKTtcbiAgfVxufVxuXG4vKipcbiAqIEdlbmVyYXRlIGEgSlNPTiBXZWIgVG9rZW4gKEpXVCkuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd8QnVmZmVyfSBwcml2YXRlS2V5IC0gdGhlIHBhdGggdG8gdGhlIHByaXZhdGUga2V5IGNlcnRpZmljYXRlXG4gKiAgICAgICAgICB0byBiZSB1c2VkIHdoZW4gc2lnbmluZyB0aGUgY2xhaW1zLlxuICogQHBhcmFtIHtPYmplY3R9IGNsYWltcyAtIG5hbWUvdmFsdWUgcGFpciBjbGFpbXMgdG8gc2lnbiB3aXRoaW4gdGhlIEpXVFxuICpcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBnZW5lcmF0ZWQgdG9rZW5cbiAqL1xuVm9uYWdlLmdlbmVyYXRlSnd0ID0gKHByaXZhdGVLZXksIGNsYWltcykgPT4ge1xuICBpZiAoIShwcml2YXRlS2V5IGluc3RhbmNlb2YgQnVmZmVyKSkge1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhwcml2YXRlS2V5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlIFwiJHtwcml2YXRlS2V5fVwiIG5vdCBmb3VuZC5gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJpdmF0ZUtleSA9IGZzLnJlYWRGaWxlU3luYyhwcml2YXRlS2V5KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGp3dEdlbmVyYXRvckluc3RhbmNlLmdlbmVyYXRlKHByaXZhdGVLZXksIGNsYWltcyk7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlIGEgU2lnbmF0dXJlIEhhc2guXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCAtIHRoZSBtZXRob2QgdG8gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIHRoZSBoYXNoXG4gKiBAcGFyYW0ge1N0cmluZ30gc2VjcmV0IC0gdGhlIHNlY3JldCB0byBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgdGhlIGhhc2hcbiAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgLSBwYXJhbXMgdG8gZ2VuZXJhdGUgaGFzaCBmcm9tXG4gKlxuICogQHJldHVybnMge1N0cmluZ30gdGhlIGdlbmVyYXRlZCB0b2tlblxuICovXG5Wb25hZ2UuZ2VuZXJhdGVTaWduYXR1cmUgPSAobWV0aG9kLCBzZWNyZXQsIHBhcmFtcykgPT4ge1xuICByZXR1cm4gaGFzaEdlbmVyYXRvckluc3RhbmNlLmdlbmVyYXRlKG1ldGhvZCwgc2VjcmV0LCBwYXJhbXMpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgVm9uYWdlO1xuIl19