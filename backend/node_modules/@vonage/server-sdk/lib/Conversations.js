"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _index = _interopRequireDefault(require("./index"));

var _Utils = _interopRequireDefault(require("./Utils"));

var _Members = _interopRequireDefault(require("./Members"));

var _Events = _interopRequireDefault(require("./Events"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Provides access to the `conversations` endpoint.
 */
class Conversations {
  static get PATH() {
    return "/beta/conversations";
  }

  static get BETA2_PATH() {
    return "/beta2/conversations";
  }

  static get V1_PATH() {
    return "/v1/conversations";
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Additional Conversations options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
    /**
     * @type Members
     */

    this.members = new _Members.default(this.creds, this.options);
    /**
     * @type Events
     */

    this.events = new _Events.default(this.creds, this.options);
  }
  /**
   * Create a new conversation.
   *
   * @param {Object} params - Parameters used when creating the conversation. See https://ea.developer.nexmo.com/api/conversation#create-a-conversation for more information.
   * @param {function} callback - function to be called when the request completes.
   */


  create(params, callback) {
    params = JSON.stringify(params);
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: Conversations.PATH,
      method: "POST",
      body: params,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer ".concat(this.creds.generateJwt())
      }
    };
    this.options.httpClient.request(config, callback);
  }
  /**
   * Get an existing conversation.
   *
   * @param {string|object} query - The unique identifier for the conversation to retrieve
   *               or a set of filter parameters for the query. For more information
   *               see https://ea.developer.nexmo.com/api/conversation#retrieve-a-conversation
   * @param {function} callback - function to be called when the request completes.
   */


  get(query, callback) {
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: typeof query === "string" ? "".concat(Conversations.PATH, "/").concat(query) : _Utils.default.createPathWithQuery(Conversations.BETA2_PATH, query),
      method: "GET",
      body: undefined,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer ".concat(this.creds.generateJwt())
      }
    };
    this.options.httpClient.request(config, callback);
  }
  /**
   * Get next page of conversations.
   *
   * @param {object} response - The response from a paginated conversations list
   *               see https://ea.developer.nexmo.com/api/conversation#listConversations
   * @param {function} callback - function to be called when the request completes.
   */


  next(response, callback) {
    if (response._links.next) {
      this.get(_Utils.default.getQuery(response._links.next.href), callback);
    } else {
      var error = new Error("The response doesn't have a next page.");
      callback(error, null);
    }
  }
  /**
   * Get previous page of conversations.
   *
   * @param {object} response - The response from a paginated conversations list
   *               see https://ea.developer.nexmo.com/api/conversation#listConversations
   * @param {function} callback - function to be called when the request completes.
   */


  prev(response, callback) {
    if (response._links.prev) {
      this.get(_Utils.default.getQuery(response._links.prev.href), callback);
    } else {
      var error = new Error("The response doesn't have a previous page.");
      callback(error, null);
    }
  }
  /**
   * Update an existing conversation.
   *
   * @param {string} conversationId - The unique identifier for the conversation to update.
   * @param {Object} params - Parameters used when updating the conversation.
   * @param {function} callback - function to be called when the request completes.
   */


  update(conversationId, params, callback) {
    params = JSON.stringify(params);
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: "".concat(Conversations.PATH, "/").concat(conversationId),
      method: "PUT",
      body: params,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer ".concat(this.creds.generateJwt())
      }
    };
    this.options.httpClient.request(config, callback);
  }
  /**
   * Record an existing conversation.
   *
   * @param {string} conversationId - The unique identifier for the conversation to record.
   * @param {Object} params - Parameters used when recording the conversation.
   * @param {function} callback - function to be called when the request completes.
   */


  record(conversationId, params, callback) {
    params = JSON.stringify(params);
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: "".concat(Conversations.V1_PATH, "/").concat(conversationId, "/record"),
      method: "PUT",
      body: params,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer ".concat(this.creds.generateJwt())
      }
    };
    this.options.httpClient.request(config, callback);
  }
  /**
   * Deleta an existing conversation.
   *
   * @param {string} conversationId - The unique identifier for the conversation to delete.
   * @param {function} callback - function to be called when the request completes.
   */


  delete(conversationId, callback) {
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: "".concat(Conversations.PATH, "/").concat(conversationId),
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer ".concat(this.creds.generateJwt())
      }
    };
    this.options.httpClient.request(config, callback);
  }

}

var _default = Conversations;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Db252ZXJzYXRpb25zLmpzIl0sIm5hbWVzIjpbIkNvbnZlcnNhdGlvbnMiLCJQQVRIIiwiQkVUQTJfUEFUSCIsIlYxX1BBVEgiLCJjb25zdHJ1Y3RvciIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImNyZWRzIiwibWVtYmVycyIsIk1lbWJlcnMiLCJldmVudHMiLCJFdmVudHMiLCJjcmVhdGUiLCJwYXJhbXMiLCJjYWxsYmFjayIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25maWciLCJob3N0IiwiYXBpSG9zdCIsInBhdGgiLCJtZXRob2QiLCJib2R5IiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJnZW5lcmF0ZUp3dCIsImh0dHBDbGllbnQiLCJyZXF1ZXN0IiwiZ2V0IiwicXVlcnkiLCJVdGlscyIsImNyZWF0ZVBhdGhXaXRoUXVlcnkiLCJ1bmRlZmluZWQiLCJuZXh0IiwicmVzcG9uc2UiLCJfbGlua3MiLCJnZXRRdWVyeSIsImhyZWYiLCJlcnJvciIsIkVycm9yIiwicHJldiIsInVwZGF0ZSIsImNvbnZlcnNhdGlvbklkIiwicmVjb3JkIiwiZGVsZXRlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOztBQUVBOztBQUVBOztBQUNBOzs7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsYUFBTixDQUFvQjtBQUNILGFBQUpDLElBQUksR0FBRztBQUNoQixXQUFPLHFCQUFQO0FBQ0Q7O0FBRW9CLGFBQVZDLFVBQVUsR0FBRztBQUN0QixXQUFPLHNCQUFQO0FBQ0Q7O0FBRWlCLGFBQVBDLE9BQU8sR0FBRztBQUNuQixXQUFPLG1CQUFQO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNFQyxFQUFBQSxXQUFXLENBQUNDLFdBQUQsRUFBNEI7QUFBQSxRQUFkQyxPQUFjLHVFQUFKLEVBQUk7QUFDckMsU0FBS0MsS0FBTCxHQUFhRixXQUFiO0FBQ0EsU0FBS0MsT0FBTCxHQUFlQSxPQUFmO0FBRUE7QUFDSjtBQUNB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QixjQUE4QnVDLGNBQTlCLFlBRk87QUFHWHJCLE1BQUFBLE1BQU0sRUFBRSxLQUhHO0FBSVhDLE1BQUFBLElBQUksRUFBRVQsTUFKSztBQUtYVSxNQUFBQSxPQUFPLEVBQUU7QUFDUCx3QkFBZ0Isa0JBRFQ7QUFFUEMsUUFBQUEsYUFBYSxtQkFBWSxLQUFLakIsS0FBTCxDQUFXa0IsV0FBWCxFQUFaO0FBRk47QUFMRSxLQUFiO0FBV0EsU0FBS25CLE9BQUwsQ0FBYW9CLFVBQWIsQ0FBd0JDLE9BQXhCLENBQWdDVixNQUFoQyxFQUF3Q0gsUUFBeEM7QUFDRDtBQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0U4QixFQUFBQSxNQUFNLENBQUNGLGNBQUQsRUFBaUI1QixRQUFqQixFQUEyQjtBQUMvQixRQUFJRyxNQUFNLEdBQUc7QUFDWEMsTUFBQUEsSUFBSSxFQUFFLEtBQUtaLE9BQUwsQ0FBYWEsT0FBYixJQUF3QixlQURuQjtBQUVYQyxNQUFBQSxJQUFJLFlBQUtwQixhQUFhLENBQUNDLElBQW5CLGNBQTJCeUMsY0FBM0IsQ0FGTztBQUdYckIsTUFBQUEsTUFBTSxFQUFFLFFBSEc7QUFJWEUsTUFBQUEsT0FBTyxFQUFFO0FBQ1Asd0JBQWdCLGtCQURUO0FBRVBDLFFBQUFBLGFBQWEsbUJBQVksS0FBS2pCLEtBQUwsQ0FBV2tCLFdBQVgsRUFBWjtBQUZOO0FBSkUsS0FBYjtBQVVBLFNBQUtuQixPQUFMLENBQWFvQixVQUFiLENBQXdCQyxPQUF4QixDQUFnQ1YsTUFBaEMsRUFBd0NILFFBQXhDO0FBQ0Q7O0FBbkxpQjs7ZUFzTExkLGEiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHZvbmFnZSBmcm9tIFwiLi9pbmRleFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxuaW1wb3J0IE1lbWJlcnMgZnJvbSBcIi4vTWVtYmVyc1wiO1xuaW1wb3J0IEV2ZW50cyBmcm9tIFwiLi9FdmVudHNcIjtcblxuLyoqXG4gKiBQcm92aWRlcyBhY2Nlc3MgdG8gdGhlIGBjb252ZXJzYXRpb25zYCBlbmRwb2ludC5cbiAqL1xuY2xhc3MgQ29udmVyc2F0aW9ucyB7XG4gIHN0YXRpYyBnZXQgUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvYmV0YS9jb252ZXJzYXRpb25zXCI7XG4gIH1cblxuICBzdGF0aWMgZ2V0IEJFVEEyX1BBVEgoKSB7XG4gICAgcmV0dXJuIFwiL2JldGEyL2NvbnZlcnNhdGlvbnNcIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgVjFfUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvdjEvY29udmVyc2F0aW9uc1wiO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uYWwgQ29udmVyc2F0aW9ucyBvcHRpb25zLlxuICAgKi9cbiAgY29uc3RydWN0b3IoY3JlZGVudGlhbHMsIG9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuY3JlZHMgPSBjcmVkZW50aWFscztcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUgTWVtYmVyc1xuICAgICAqL1xuICAgIHRoaXMubWVtYmVycyA9IG5ldyBNZW1iZXJzKHRoaXMuY3JlZHMsIHRoaXMub3B0aW9ucyk7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSBFdmVudHNcbiAgICAgKi9cbiAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudHModGhpcy5jcmVkcywgdGhpcy5vcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgY29udmVyc2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIC0gUGFyYW1ldGVycyB1c2VkIHdoZW4gY3JlYXRpbmcgdGhlIGNvbnZlcnNhdGlvbi4gU2VlIGh0dHBzOi8vZWEuZGV2ZWxvcGVyLm5leG1vLmNvbS9hcGkvY29udmVyc2F0aW9uI2NyZWF0ZS1hLWNvbnZlcnNhdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgLSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiB0aGUgcmVxdWVzdCBjb21wbGV0ZXMuXG4gICAqL1xuICBjcmVhdGUocGFyYW1zLCBjYWxsYmFjaykge1xuICAgIHBhcmFtcyA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG5cbiAgICB2YXIgY29uZmlnID0ge1xuICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICBwYXRoOiBDb252ZXJzYXRpb25zLlBBVEgsXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgYm9keTogcGFyYW1zLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuY3JlZHMuZ2VuZXJhdGVKd3QoKX1gLFxuICAgICAgfSxcbiAgICB9O1xuICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoY29uZmlnLCBjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFuIGV4aXN0aW5nIGNvbnZlcnNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBxdWVyeSAtIFRoZSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGNvbnZlcnNhdGlvbiB0byByZXRyaWV2ZVxuICAgKiAgICAgICAgICAgICAgIG9yIGEgc2V0IG9mIGZpbHRlciBwYXJhbWV0ZXJzIGZvciB0aGUgcXVlcnkuIEZvciBtb3JlIGluZm9ybWF0aW9uXG4gICAqICAgICAgICAgICAgICAgc2VlIGh0dHBzOi8vZWEuZGV2ZWxvcGVyLm5leG1vLmNvbS9hcGkvY29udmVyc2F0aW9uI3JldHJpZXZlLWEtY29udmVyc2F0aW9uXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIC0gZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHJlcXVlc3QgY29tcGxldGVzLlxuICAgKi9cbiAgZ2V0KHF1ZXJ5LCBjYWxsYmFjaykge1xuICAgIHZhciBjb25maWcgPSB7XG4gICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgIHBhdGg6XG4gICAgICAgIHR5cGVvZiBxdWVyeSA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgID8gYCR7Q29udmVyc2F0aW9ucy5QQVRIfS8ke3F1ZXJ5fWBcbiAgICAgICAgICA6IFV0aWxzLmNyZWF0ZVBhdGhXaXRoUXVlcnkoQ29udmVyc2F0aW9ucy5CRVRBMl9QQVRILCBxdWVyeSksXG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBib2R5OiB1bmRlZmluZWQsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5jcmVkcy5nZW5lcmF0ZUp3dCgpfWAsXG4gICAgICB9LFxuICAgIH07XG4gICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChjb25maWcsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbmV4dCBwYWdlIG9mIGNvbnZlcnNhdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSByZXNwb25zZSAtIFRoZSByZXNwb25zZSBmcm9tIGEgcGFnaW5hdGVkIGNvbnZlcnNhdGlvbnMgbGlzdFxuICAgKiAgICAgICAgICAgICAgIHNlZSBodHRwczovL2VhLmRldmVsb3Blci5uZXhtby5jb20vYXBpL2NvbnZlcnNhdGlvbiNsaXN0Q29udmVyc2F0aW9uc1xuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSByZXF1ZXN0IGNvbXBsZXRlcy5cbiAgICovXG4gIG5leHQocmVzcG9uc2UsIGNhbGxiYWNrKSB7XG4gICAgaWYgKHJlc3BvbnNlLl9saW5rcy5uZXh0KSB7XG4gICAgICB0aGlzLmdldChVdGlscy5nZXRRdWVyeShyZXNwb25zZS5fbGlua3MubmV4dC5ocmVmKSwgY2FsbGJhY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihcIlRoZSByZXNwb25zZSBkb2Vzbid0IGhhdmUgYSBuZXh0IHBhZ2UuXCIpO1xuICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcHJldmlvdXMgcGFnZSBvZiBjb252ZXJzYXRpb25zLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2UgZnJvbSBhIHBhZ2luYXRlZCBjb252ZXJzYXRpb25zIGxpc3RcbiAgICogICAgICAgICAgICAgICBzZWUgaHR0cHM6Ly9lYS5kZXZlbG9wZXIubmV4bW8uY29tL2FwaS9jb252ZXJzYXRpb24jbGlzdENvbnZlcnNhdGlvbnNcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgLSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiB0aGUgcmVxdWVzdCBjb21wbGV0ZXMuXG4gICAqL1xuICBwcmV2KHJlc3BvbnNlLCBjYWxsYmFjaykge1xuICAgIGlmIChyZXNwb25zZS5fbGlua3MucHJldikge1xuICAgICAgdGhpcy5nZXQoVXRpbHMuZ2V0UXVlcnkocmVzcG9uc2UuX2xpbmtzLnByZXYuaHJlZiksIGNhbGxiYWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXCJUaGUgcmVzcG9uc2UgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcGFnZS5cIik7XG4gICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbiBleGlzdGluZyBjb252ZXJzYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb252ZXJzYXRpb25JZCAtIFRoZSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGNvbnZlcnNhdGlvbiB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgLSBQYXJhbWV0ZXJzIHVzZWQgd2hlbiB1cGRhdGluZyB0aGUgY29udmVyc2F0aW9uLlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSByZXF1ZXN0IGNvbXBsZXRlcy5cbiAgICovXG4gIHVwZGF0ZShjb252ZXJzYXRpb25JZCwgcGFyYW1zLCBjYWxsYmFjaykge1xuICAgIHBhcmFtcyA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG5cbiAgICB2YXIgY29uZmlnID0ge1xuICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICBwYXRoOiBgJHtDb252ZXJzYXRpb25zLlBBVEh9LyR7Y29udmVyc2F0aW9uSWR9YCxcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGJvZHk6IHBhcmFtcyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLmNyZWRzLmdlbmVyYXRlSnd0KCl9YCxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoY29uZmlnLCBjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIGFuIGV4aXN0aW5nIGNvbnZlcnNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgY29udmVyc2F0aW9uIHRvIHJlY29yZC5cbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyAtIFBhcmFtZXRlcnMgdXNlZCB3aGVuIHJlY29yZGluZyB0aGUgY29udmVyc2F0aW9uLlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSByZXF1ZXN0IGNvbXBsZXRlcy5cbiAgICovXG4gIHJlY29yZChjb252ZXJzYXRpb25JZCwgcGFyYW1zLCBjYWxsYmFjaykge1xuICAgIHBhcmFtcyA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG5cbiAgICB2YXIgY29uZmlnID0ge1xuICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICBwYXRoOiBgJHtDb252ZXJzYXRpb25zLlYxX1BBVEh9LyR7Y29udmVyc2F0aW9uSWR9L3JlY29yZGAsXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBib2R5OiBwYXJhbXMsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5jcmVkcy5nZW5lcmF0ZUp3dCgpfWAsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KGNvbmZpZywgY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0YSBhbiBleGlzdGluZyBjb252ZXJzYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb252ZXJzYXRpb25JZCAtIFRoZSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGNvbnZlcnNhdGlvbiB0byBkZWxldGUuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIC0gZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHJlcXVlc3QgY29tcGxldGVzLlxuICAgKi9cbiAgZGVsZXRlKGNvbnZlcnNhdGlvbklkLCBjYWxsYmFjaykge1xuICAgIHZhciBjb25maWcgPSB7XG4gICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgIHBhdGg6IGAke0NvbnZlcnNhdGlvbnMuUEFUSH0vJHtjb252ZXJzYXRpb25JZH1gLFxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuY3JlZHMuZ2VuZXJhdGVKd3QoKX1gLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChjb25maWcsIGNhbGxiYWNrKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDb252ZXJzYXRpb25zO1xuIl19