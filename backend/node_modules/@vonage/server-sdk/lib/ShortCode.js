"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var querystring = require("querystring");
/**
 * Provides access to the `ShortCode` endpoint.
 */


class ShortCode {
  static get PATH() {
    return "/sc/us/${type}/json";
  }

  static get ERROR_MESSAGES() {
    return {
      to: "Invalid to address",
      msgParams: "Invalid shortcode message parameters"
    };
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Additional ShortCode options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
  }

  _sendRequest(endpoint, method, callback) {
    endpoint.path = endpoint.path + (endpoint.path.indexOf("?") > 0 ? "&" : "?") + querystring.stringify({
      api_key: this.creds.apiKey,
      api_secret: this.creds.apiSecret
    });
    this.options.httpClient.request(endpoint, method, callback);
  }

  _sendViaShortcode(type, recipient, messageParams, opts, callback) {
    if (!recipient) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.to));
    }

    if (!messageParams || !Object.keys(messageParams)) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.msgParams));
    }

    opts = opts || {};
    var path = ShortCode.PATH.replace("${type}", type);
    Object.keys(messageParams).forEach(function (key) {
      opts[key] = messageParams[key];
    });
    opts.to = recipient;
    path += "?" + querystring.stringify(opts);
    this.options.logger.info("sending message from shortcode " + type + " to " + recipient + " with parameters " + JSON.stringify(messageParams));

    this._sendRequest({
      host: this.options.restHost || "rest.nexmo.com",
      path: path
    }, "POST", function (err, apiResponse) {
      if (!err && apiResponse.status && apiResponse.messages[0].status > 0) {
        _Utils.default.sendError(callback, new Error(apiResponse.messages[0]["error-text"]), apiResponse);
      } else {
        if (callback) callback(err, apiResponse);
      }
    });
  }

  shortcodeAlert(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("alert", recipient, messageParams, opts, callback);
  }

  shortcode2FA(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("2fa", recipient, messageParams, opts, callback);
  }

  shortcodeMarketing(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("marketing", recipient, messageParams, opts, callback);
  }

}

var _default = ShortCode;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TaG9ydENvZGUuanMiXSwibmFtZXMiOlsicXVlcnlzdHJpbmciLCJyZXF1aXJlIiwiU2hvcnRDb2RlIiwiUEFUSCIsIkVSUk9SX01FU1NBR0VTIiwidG8iLCJtc2dQYXJhbXMiLCJjb25zdHJ1Y3RvciIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImNyZWRzIiwiX3NlbmRSZXF1ZXN0IiwiZW5kcG9pbnQiLCJtZXRob2QiLCJjYWxsYmFjayIsInBhdGgiLCJpbmRleE9mIiwic3RyaW5naWZ5IiwiYXBpX2tleSIsImFwaUtleSIsImFwaV9zZWNyZXQiLCJhcGlTZWNyZXQiLCJodHRwQ2xpZW50IiwicmVxdWVzdCIsIl9zZW5kVmlhU2hvcnRjb2RlIiwidHlwZSIsInJlY2lwaWVudCIsIm1lc3NhZ2VQYXJhbXMiLCJvcHRzIiwiVXRpbHMiLCJzZW5kRXJyb3IiLCJFcnJvciIsIk9iamVjdCIsImtleXMiLCJyZXBsYWNlIiwiZm9yRWFjaCIsImtleSIsImxvZ2dlciIsImluZm8iLCJKU09OIiwiaG9zdCIsInJlc3RIb3N0IiwiZXJyIiwiYXBpUmVzcG9uc2UiLCJzdGF0dXMiLCJtZXNzYWdlcyIsInNob3J0Y29kZUFsZXJ0Iiwic2hvcnRjb2RlMkZBIiwic2hvcnRjb2RlTWFya2V0aW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOzs7O0FBRUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsYUFBRCxDQUF6QjtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0EsTUFBTUMsU0FBTixDQUFnQjtBQUNDLGFBQUpDLElBQUksR0FBRztBQUNoQixXQUFPLHFCQUFQO0FBQ0Q7O0FBRXdCLGFBQWRDLGNBQWMsR0FBRztBQUMxQixXQUFPO0FBQ0xDLE1BQUFBLEVBQUUsRUFBRSxvQkFEQztBQUVMQyxNQUFBQSxTQUFTLEVBQUU7QUFGTixLQUFQO0FBSUQ7QUFFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNFQyxFQUFBQSxXQUFXLENBQUNDLFdB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UUFBSixFQUFjQSxRQUFRLENBQUM0QixHQUFELEVBQU1DLFdBQU4sQ0FBUjtBQUNmO0FBQ0YsS0FoQkg7QUFrQkQ7O0FBRURHLEVBQUFBLGNBQWMsQ0FBQ3BCLFNBQUQsRUFBWUMsYUFBWixFQUEyQkMsSUFBM0IsRUFBaUNkLFFBQWpDLEVBQTJDO0FBQ3ZELFNBQUtVLGlCQUFMLENBQXVCLE9BQXZCLEVBQWdDRSxTQUFoQyxFQUEyQ0MsYUFBM0MsRUFBMERDLElBQTFELEVBQWdFZCxRQUFoRTtBQUNEOztBQUNEaUMsRUFBQUEsWUFBWSxDQUFDckIsU0FBRCxFQUFZQyxhQUFaLEVBQTJCQyxJQUEzQixFQUFpQ2QsUUFBakMsRUFBMkM7QUFDckQsU0FBS1UsaUJBQUwsQ0FBdUIsS0FBdkIsRUFBOEJFLFNBQTlCLEVBQXlDQyxhQUF6QyxFQUF3REMsSUFBeEQsRUFBOERkLFFBQTlEO0FBQ0Q7O0FBQ0RrQyxFQUFBQSxrQkFBa0IsQ0FBQ3RCLFNBQUQsRUFBWUMsYUFBWixFQUEyQkMsSUFBM0IsRUFBaUNkLFFBQWpDLEVBQTJDO0FBQzNELFNBQUtVLGlCQUFMLENBQ0UsV0FERixFQUVFRSxTQUZGLEVBR0VDLGFBSEYsRUFJRUMsSUFKRixFQUtFZCxRQUxGO0FBT0Q7O0FBMUZhOztlQTZGRFosUyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxudmFyIHF1ZXJ5c3RyaW5nID0gcmVxdWlyZShcInF1ZXJ5c3RyaW5nXCIpO1xuXG4vKipcbiAqIFByb3ZpZGVzIGFjY2VzcyB0byB0aGUgYFNob3J0Q29kZWAgZW5kcG9pbnQuXG4gKi9cbmNsYXNzIFNob3J0Q29kZSB7XG4gIHN0YXRpYyBnZXQgUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvc2MvdXMvJHt0eXBlfS9qc29uXCI7XG4gIH1cblxuICBzdGF0aWMgZ2V0IEVSUk9SX01FU1NBR0VTKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0bzogXCJJbnZhbGlkIHRvIGFkZHJlc3NcIixcbiAgICAgIG1zZ1BhcmFtczogXCJJbnZhbGlkIHNob3J0Y29kZSBtZXNzYWdlIHBhcmFtZXRlcnNcIixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uYWwgU2hvcnRDb2RlIG9wdGlvbnMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjcmVkZW50aWFscywgb3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5jcmVkcyA9IGNyZWRlbnRpYWxzO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICBfc2VuZFJlcXVlc3QoZW5kcG9pbnQsIG1ldGhvZCwgY2FsbGJhY2spIHtcbiAgICBlbmRwb2ludC5wYXRoID1cbiAgICAgIGVuZHBvaW50LnBhdGggK1xuICAgICAgKGVuZHBvaW50LnBhdGguaW5kZXhPZihcIj9cIikgPiAwID8gXCImXCIgOiBcIj9cIikgK1xuICAgICAgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHtcbiAgICAgICAgYXBpX2tleTogdGhpcy5jcmVkcy5hcGlLZXksXG4gICAgICAgIGFwaV9zZWNyZXQ6IHRoaXMuY3JlZHMuYXBpU2VjcmV0LFxuICAgICAgfSk7XG4gICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChlbmRwb2ludCwgbWV0aG9kLCBjYWxsYmFjayk7XG4gIH1cblxuICBfc2VuZFZpYVNob3J0Y29kZSh0eXBlLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFyZWNpcGllbnQpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKFNob3J0Q29kZS5FUlJPUl9NRVNTQUdFUy50bykpO1xuICAgIH1cbiAgICBpZiAoIW1lc3NhZ2VQYXJhbXMgfHwgIU9iamVjdC5rZXlzKG1lc3NhZ2VQYXJhbXMpKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihTaG9ydENvZGUuRVJST1JfTUVTU0FHRVMubXNnUGFyYW1zKSk7XG4gICAgfVxuICAgIG9wdHMgPSBvcHRzIHx8IHt9O1xuICAgIHZhciBwYXRoID0gU2hvcnRDb2RlLlBBVEgucmVwbGFjZShcIiR7dHlwZX1cIiwgdHlwZSk7XG4gICAgT2JqZWN0LmtleXMobWVzc2FnZVBhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBvcHRzW2tleV0gPSBtZXNzYWdlUGFyYW1zW2tleV07XG4gICAgfSk7XG4gICAgb3B0cy50byA9IHJlY2lwaWVudDtcbiAgICBwYXRoICs9IFwiP1wiICsgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KG9wdHMpO1xuICAgIHRoaXMub3B0aW9ucy5sb2dnZXIuaW5mbyhcbiAgICAgIFwic2VuZGluZyBtZXNzYWdlIGZyb20gc2hvcnRjb2RlIFwiICtcbiAgICAgICAgdHlwZSArXG4gICAgICAgIFwiIHRvIFwiICtcbiAgICAgICAgcmVjaXBpZW50ICtcbiAgICAgICAgXCIgd2l0aCBwYXJhbWV0ZXJzIFwiICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcylcbiAgICApO1xuICAgIHRoaXMuX3NlbmRSZXF1ZXN0KFxuICAgICAge1xuICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMucmVzdEhvc3QgfHwgXCJyZXN0Lm5leG1vLmNvbVwiLFxuICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgfSxcbiAgICAgIFwiUE9TVFwiLFxuICAgICAgZnVuY3Rpb24gKGVyciwgYXBpUmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKCFlcnIgJiYgYXBpUmVzcG9uc2Uuc3RhdHVzICYmIGFwaVJlc3BvbnNlLm1lc3NhZ2VzWzBdLnN0YXR1cyA+IDApIHtcbiAgICAgICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgICAgIG5ldyBFcnJvcihhcGlSZXNwb25zZS5tZXNzYWdlc1swXVtcImVycm9yLXRleHRcIl0pLFxuICAgICAgICAgICAgYXBpUmVzcG9uc2VcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZXJyLCBhcGlSZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgc2hvcnRjb2RlQWxlcnQocmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3NlbmRWaWFTaG9ydGNvZGUoXCJhbGVydFwiLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKTtcbiAgfVxuICBzaG9ydGNvZGUyRkEocmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3NlbmRWaWFTaG9ydGNvZGUoXCIyZmFcIiwgcmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjayk7XG4gIH1cbiAgc2hvcnRjb2RlTWFya2V0aW5nKHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICB0aGlzLl9zZW5kVmlhU2hvcnRjb2RlKFxuICAgICAgXCJtYXJrZXRpbmdcIixcbiAgICAgIHJlY2lwaWVudCxcbiAgICAgIG1lc3NhZ2VQYXJhbXMsXG4gICAgICBvcHRzLFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNob3J0Q29kZTtcbiJdfQ==